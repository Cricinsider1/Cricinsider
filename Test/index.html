<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaka Player Live Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.min.js"></script>
    <style>
        .shaka-video-container {
            width: 100%;
            max-width: 800px;
            margin: auto;
            position: relative;
        }
        video {
            width: 100%;
        }
    </style>
</head>
<body>

<div class="shaka-video-container">
    <video id="video" controls></video>
</div>

<script>
    let player; // Global Shaka Player instance
    let previousSettings = {
        playbackRate: 1, // Default playback rate
        muted: true      // Default to muted
    };

    // Device detection function for controls
    function isMobile() {
        return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
    }

    const channelstreamInfo = {
        streamUrl: "", // Will be populated by fetchM3u8Url
        authBearer: "",
        streamPoster: "https://maxplay-tv.fun/prox.jpg"
    };

    // Fetch the M3U8 URL
    function fetchM3u8Url() {
        const cricid = "starhindi";
        channelstreamInfo.streamUrl = "https://caa89d84-618a-41f3-bfd8-66b2fb7dd477.deepnoteproject.com/api/" + cricid + ".m3u8";
        return channelstreamInfo.streamUrl;
    }

    // Initialize Shaka Player
    async function initializePlayer() {
        const videoElement = document.getElementById('video');

        // Set poster image
        videoElement.poster = channelstreamInfo.streamPoster;

        // Video settings
        videoElement.muted = previousSettings.muted;
        videoElement.autoplay = true;
        videoElement.controls = true;

        // Restore settings
        videoElement.playbackRate = previousSettings.playbackRate;

        // Store changes during playback
        videoElement.addEventListener('ratechange', () => {
            previousSettings.playbackRate = videoElement.playbackRate;
        });

        videoElement.addEventListener('volumechange', () => {
            previousSettings.muted = videoElement.muted;
        });

        // Ensure Shaka Player is supported
        if (!shaka.Player.isBrowserSupported()) {
            console.error('Shaka Player is not supported on this browser.');
            return;
        }

        // Create Shaka Player instance
        player = new shaka.Player(videoElement);

        // Listen for error events
        player.addEventListener('error', (event) => {
            console.error('Error code', event.detail.code, 'object', event.detail);
        });

        try {
            // Fetch and load the video stream
            const manifestUri = fetchM3u8Url();
            await player.load(manifestUri);
            console.log('The video has been loaded successfully!');
        } catch (error) {
            console.error('Error loading the video', error);
        }
    }

    // Initialize the player once the document is ready
    document.addEventListener('DOMContentLoaded', () => {
        initializePlayer();
    });
</script>

</body>
</html>