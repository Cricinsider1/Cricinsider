<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>TG_@Cricinsider365</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/shaka-player.ui.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/controls.min.css" crossorigin="anonymous">
<style>
    body {
        background-color: #000;
    }
    .shaka-spinner-container {
        display: none;
    }
</style>
<body style="margin: 0;">

<div data-shaka-player-container style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
    <video autoplay muted data-shaka-player id="video" poster="https://cxh.pages.dev/L.jpg" style="width:100%;height:100%"></video>
</div>

<script>
    async function init() {
        const video = document.getElementById("video");
        const ui = video.ui;
        const controls = ui.getControls();
        const player = controls.getPlayer();

        player.configure({
            drm: {
                clearKeys: {
                    'd84c325f36814f39bbe59080272b10c3': "550727de4c96ef1ecff874905493580f"
                }
            }
        });

        // Configure UI: Add Overflow Menu dynamically
        ui.configure({
            controlPanelElements: [
                "play_pause",
                "mute",
                "volume",
                "spacer",
                "time_and_duration",
                "picture_in_picture",
                "quality",
                "fullscreen",
                "overflow_menu"
            ],
            overflowMenuButtons: [
                "playback_rate" // Add playback rate by default
            ],
            volumeBarColors: {
                base: "rgba(0, 0, 255, 1)",
                level: "rgb(0, 255, 0)"
            },
            seekBarColors: {
                base: "rgb(255, 0, 0)",
                buffered: "rgb(255, 255, 0)",
                played: "rgba(0, 128, 128, 1)"
            }
        });

        window.player = player;
        window.ui = ui;

        player.addEventListener("error", onPlayerErrorEvent);
        controls.addEventListener("error", onUIErrorEvent);

        try {
            await player.load("https://ssc-1-enc.edgenextcdn.net/out/v1/c696e4819b55414388a1a487e8a45ca1/index.mpd");
            console.log("The video has now been loaded!");
            
            // Dynamically update the Overflow Menu with available tracks
            updateOverflowMenu(player, ui);

        } catch (error) {
            onPlayerError(error);
        }
    }

    // Dynamically add audio and text language tracks to the Overflow Menu
    function updateOverflowMenu(player, ui) {
        const audioTracks = player.getVariantTracks(); // Get available audio tracks
        const textTracks = player.getTextTracks();    // Get available subtitle tracks

        // Add audio language options
        if (audioTracks.length > 0) {
            ui.configure({
                overflowMenuButtons: ui.getConfiguration().overflowMenuButtons.concat("audio_languages")
            });
        }

        // Add subtitle language options
        if (textTracks.length > 0) {
            ui.configure({
                overflowMenuButtons: ui.getConfiguration().overflowMenuButtons.concat("text_languages")
            });
        }
    }

    function onPlayerErrorEvent(event) {
        onPlayerError(event.detail);
    }

    function onPlayerError(error) {
        console.error("Error code", error.code, "object", error);
    }

    function onUIErrorEvent(event) {
        onPlayerError(event.detail);
    }

    function initFailed() {
        console.error("Unable to load the UI library!");
    }

    document.addEventListener("shaka-ui-loaded", init);
    document.addEventListener("shaka-ui-load-failed", initFailed);
</script>
</body>
</html>