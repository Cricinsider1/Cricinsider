<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Fast DRM Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/shaka-player.ui.min.js" crossorigin="anonymous"></script>    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.1/controls.min.css" crossorigin="anonymous">
    <style>
        body {
            background-color: black;
            margin: 0;
        }
        [data-shaka-player-container] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="spinner" id="spinner">Loading...</div>
    <div data-shaka-player-container>
        <video autoplay muted data-shaka-player id="video"></video>
    </div>

    <script>
        async function initPlayer() {
            const spinner = document.getElementById("spinner");
            const video = document.getElementById("video");
            const ui = video.ui;
            const controls = ui.getControls();
            const player = controls.getPlayer();

            spinner.style.display = "block"; // Show spinner during initialization

            // Configure DRM for Widevine and Clear Key
            player.configure({
                drm: {
                    servers: {
                        'com.widevine.alpha': 'https://widevine-license-server-url.com', // Replace with your license server
                    },
                    clearKeys: {
                        'ae26845bd33038a9c0774a0981007294': '63ac662dde310cfb4cc6f9b43b34196d' // Replace with your keys
                    },
                },
                streaming: {
                    rebufferingGoal: 5, // Buffer 5 seconds ahead
                    bufferingGoal: 10, // Keep a 10-second buffer
                    retryParameters: {
                        maxAttempts: 3,
                        baseDelay: 1000,
                        backoffFactor: 2,
                        fuzzFactor: 0.5
                    }
                },
                abr: {
                    enabled: true,
                    defaultBandwidthEstimate: 5000000, // 5 Mbps for faster start
                }
            });

            // Handle player errors
            player.addEventListener("error", onPlayerError);

            // Load video stream
            try {
                await player.load("https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/clients/dash/enc/wf8usag51e/out/v1/bd3b0c314fff4bb1ab4693358f3cd2d3/cenc.mpd"); // Replace with your MPD URL
                console.log("Stream loaded successfully!");
            } catch (error) {
                onPlayerError(error);
            } finally {
                spinner.style.display = "none"; // Hide spinner after loading
            }

            console.log("Player initialized for fast playback.");
        }

        function onPlayerError(error) {
            console.error("Player error:", error);
            alert(`Playback error: ${error.message}`);
        }

        // Initialize player on load
        document.addEventListener("shaka-ui-loaded", initPlayer);
    </script>
</body>
</html>