<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plyr with Quality Selector</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
  <style>
    #quality-control {
      display: none;
    }
  </style>
</head>
<body>
  <video id="player" controls crossorigin playsinline></video>

  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('player');
      const source = 'your-hls-stream-url.m3u8'; // Replace with your HLS stream URL

      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(source);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          // Initialize Plyr
          const player = new Plyr(video, {
            controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'fullscreen'],
            settings: ['quality'], // Add quality in settings menu
          });

          // Add qualities to Plyr settings
          const qualities = hls.levels.map((level, index) => ({
            label: level.height + 'p',
            value: index,
          }));

          // Include an "Auto" option for adaptive streaming
          qualities.unshift({ label: 'Auto', value: -1 });

          // Hook into the Plyr quality change event
          player.on('qualitychange', (event) => {
            const quality = event.detail.value;
            hls.currentLevel = quality === -1 ? -1 : quality;
          });

          // Set initial quality menu
          player.config.quality = {
            default: -1, // Default to auto
            options: qualities.map(q => q.value),
            forced: true,
            onChange: (quality) => {
              hls.currentLevel = quality;
            },
          };

          // Expose the player globally for debugging
          window.player = player;
        });
      } else {
        // If HLS is not supported
        video.src = source;
        const player = new Plyr(video);
      }
    });
  </script>
</body>
</html>