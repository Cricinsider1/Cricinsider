<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willow HD</title>
    <meta name="robots" content="noindex, nofollow">
    <meta name="referrer" content="no-referrer">
    <link rel="shortcut icon" href="https://live.drmlive.in/sports/willow.jpg">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: black;
        }
        #player {
            width: 100vw;
            height: 100vh;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>

    <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

            const m3u8Url = "https://p-cdn4-a-cg14-linear-cbd46b77.movetv.com/clipslist/22/20250130T145341Z/20250130T165341Z/master_7_3_widevine.m3u8";
            const encryptedToken = "Mk9ocFR3U1RTVnRZQkNTcER1b2pGdTlzSlBQN3h5WktheitUR0g1Z2hteDJGZVNjbHhGRXppTXViUXRuTlIwYg==";

            async function fetchClearKey(pssh) {
                try {
                    const response = await fetch("key.php", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ pssh, token: encryptedToken })
                    });

                    if (!response.ok) throw new Error("Failed to fetch key");

                    return await response.json();
                } catch (error) {
                    console.error("Error fetching ClearKey:", error);
                    return null;
                }
            }

            async function fetchPSSHFromM3U8(m3u8Url) {
                try {
                    const response = await fetch(m3u8Url);
                    if (!response.ok) throw new Error("Failed to fetch M3U8");

                    const m3u8Text = await response.text();
                    const sessionKeyTag = m3u8Text.split("\n").find(line =>
                        line.startsWith("#EXT-X-SESSION-KEY") &&
                        line.includes('KEYFORMAT="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"')
                    );

                    if (!sessionKeyTag) return null;

                    const uriMatch = sessionKeyTag.match(/URI="data:text\/plain;base64,([^"]+)"/);
                    return uriMatch ? uriMatch[1] : null;
                } catch (error) {
                    console.error("Error fetching PSSH:", error);
                    return null;
                }
            }

            async function initializePlayer() {
                try {
                    const pssh = await fetchPSSHFromM3U8(m3u8Url);
                    if (!pssh) throw new Error("PSSH not found");

                    const keys = await fetchClearKey(pssh);
                    if (!keys) throw new Error("Keys not found");

                    jwplayer("player").setup({
                        playlist: [{
                            sources: [{
                                default: true,
                                type: "dash",
                                file: m3u8Url,
                                drm: {
                                    clearkey: {
                                        keyId: keys.keyId,
                                        key: keys.key
                                    }
                                },
                                label: "HD"
                            }]
                        }],
                        width: "100%",
                        height: "100%",
                        aspectratio: "16:9",
                        autostart: true
                    });
                } catch (error) {
                    console.error("Error initializing player:", error);
                }
            }

            initializePlayer();
        });
    </script>
</head>
<body>
    <div id="player"></div>
</body>
</html>